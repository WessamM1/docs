---
title:  Environment Promotion
---

As a best practice, each deployment environment (developent, production, etc.) should map to a Control Plane [Org](/api-reference/org).

The main benefit of having each environment under a separate [Org](/api-reference/org) is that definitions of different [GVCs](/api-reference/gvc) and [Workloads](/api-reference/workload)
can be applied to different [Orgs](/api-reference/org) without having any objects include an environment name.

For example, in the development [Org](/api-reference/org), you could apply nearly the same YAML
manifest files (used by [cpln apply](/cpln-apply)) as the
production [Org](/api-reference/org) with different content for your secrets.

During the promotion process, the [image](/api-reference/image) that was built for development can be referred to by other [Workloads](/api-reference/workload) in the same [Org](/api-reference/org) and
across [Orgs](/api-reference/org). This is a great time saver for lengthy build processes.

## [Promotion using GitHub Actions](#github-actions)

By leveraging the functionality of [GitHub Actions](https://docs.github.com/en/actions), promoting code changes from one environment to another is as easy as
committing/pushing your code and opening/merging pull requests.

This [example](https://github.com/controlplane-com/promotion-demo) project contains three
GitHub Actions that perform the following:

This project contains three GitHub Actions (in the `./.github/workflows` directory) that perform the following:

1. On a pull request (or updates to an existing pull request) to the `main` branch, the application is containerized and pushed
   to the dev [Org's](/api-reference/org) private repository. The [GVC](/api-reference/gvc) and `Review Workload` is created/updated by applying the YAML contents of the
   files `./cpln/cpln-gvc.yaml` and `./cpln/cpln-workload.yaml`. The name of the `Review Workload` will be prefixed by the
   name of the branch that created the pull request.
2. When a pull request is accepted and the code is merged to the `main` branch, a `dev` [Workload](/api-reference/workload) is
   updated (or created if it doesn't exists) in the dev [Org](/api-reference/org) by applying the same files as step 1, except that the [Workload](/api-reference/workload)
   name is prefixed with `dev`. This allows the application to be reviewed and tested before being pushed to the production [Org](/api-reference/org).
3. The promotion to the `stage` and `prod` environment is accomplished by manually executing the `Deploy-To-Stage-or-Prod`
   workflow and selecting the target environment. The target [GVC](/api-reference/gvc) and [Workload](/api-reference/workload) in the production [Org](/api-reference/org) is updated (or created if
   it doesn't exists) by applying the YAML contents of the files `./cpln/cpln-gvc-prod.yaml` and `./cpln/cpln-workload.yaml`. The main
   difference between the two [GVC](/api-reference/gvc) files is that the `prod` version contains the `Pull Secret` that is needed the pull the [image](/api-reference/image)
   from the dev Org. The `stage` and `prod` [Workloads](/api-reference/workload) refers to the [image](/api-reference/image) that was pushed to the development [Org](/api-reference/org).

## [Review Workload](#review-workload)

The above example demonstrates the concept of a **Review Workload**. This [Workload](/api-reference/workload) allows for review and testing of the application
before being promoted to upstream [Workloads](/api-reference/workload). The deployment of the **Review Workload** occurs when a pull request from a feature branch to the
`main` branch is opened. The application will only be promoted to the `dev` [Workload](/api-reference/workload) if the pull request is closed and merged.

## [Permissions](#permissions)

To control which users have the ability to perform sensitive actions, such as merging a pull request, you can
utilize the built-in capabilities of GitHub by creating a custom repository role.

Review these [instructions](https://docs.github.com/en/enterprise-cloud@latest/organizations/managing-peoples-access-to-your-organization-with-roles/managing-custom-repository-roles-for-an-organization) on how to create a role.

## [Notes](#notes)

- The above example demonstrates promoting code between four environments (review and development
  in one [Org](/api-reference/org), and staging and production in a
  separate [Org](/api-reference/org)). Of course, you can arrange each environment in
  its own [Org](/api-reference/org), or you can mix multiple environments within
  an [Org](/api-reference/org) as is done in the example. There is no limit to the
  number of [Orgs](/api-reference/org) / environments
  that can be created. The example can be extended to your own unique deployment requirements.
- For more complex applications, each environment's [GVC](/api-reference/gvc) / [Workload](/api-reference/workload) needs to be configured with its own:
  - [Domain](/api-reference/domain)
  - [Pull Secrets](/api-reference/gvc#pull-secrets)
  - [Environment Variables](/api-reference/workload#environment-variables)
